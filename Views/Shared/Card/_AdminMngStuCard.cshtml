@model AdminMngStuCard

<tr>
    <td scope="row" class="table-index">@Model.TableIndex</td>
    <td>@Model.StuId</td>
    <td>@Model.Name</td>
    <td>@(Model.Gender switch {
        Gender.male => "Nam",
        Gender.female => "Nữ",
        _ => string.Empty
        })</td>
    <td>@Model.BDay</td>
    <td>@Model.Tel</td>
    <td>
        <div class="button-group-wrapper course-manager">            <button class="card-btn course-detail EditStuProfileBtn" idx="@Model.StuId" data-bs-toggle="modal" data-bs-target='.EditStudentModal[idx="@Model.StuId"]'>Sửa thông tin</button>
            @await Html.PartialAsync("Popup/_EditStudentPopup", Model.StuId)           
            <button class="card-btn course-detail ViewStuCoursesBtn" idx="@Model.StuId" data-student-name="@Model.Name" data-bs-toggle="modal" data-bs-target='.StudentCoursesModal[idx="@Model.StuId"]'>Xem khóa học</button>
            @await Html.PartialAsync("Popup/_AdminStuCorPopup", Model.StuId)           
            <button class="card-btn course-detail" data-bs-toggle="modal" data-bs-target="#StudentRatingModal">Xem đánh giá </button>
            @* @await Html.PartialAsync("Popup/_StudentRatingPopup") *@
        </div>
    </td>
</tr>
<script>
    document.querySelector(`.EditStuProfileBtn[idx="${@Model.StuId}"]`).addEventListener('click', function () {
        const getUrl = "/AdminAPI/GetAdminEditStuProfileForm";
        const placeholderSelector = `.AdminEditStuProfileFormPlaceholder[idx="${@Model.StuId}"]`;
        initPagination(null, getUrl, placeholderSelector, {stuId: @Model.StuId});
    });
    
    document.querySelector(`.ViewStuCoursesBtn[idx="${@Model.StuId}"]`).addEventListener('click', function () {
        const studentName = this.getAttribute('data-student-name');
        const modalTitle = document.querySelector(`.StudentCoursesModal[idx="${@Model.StuId}"] .modal-title`);
        modalTitle.textContent = `Danh sách khóa học của học viên ${studentName}`;
        
        const getUrl = "/AdminAPI/GetStudentCourses";
        const placeholderSelector = `.StudentCoursesPlaceholder[idx="${@Model.StuId}"]`;
        
        // Use fetch directly as it's simpler for this case
        fetch(`${getUrl}?stuId=${@Model.StuId}`)
            .then(response => response.text())
            .then(html => {
                document.querySelector(placeholderSelector).innerHTML = html;
            })
            .catch(error => {
                console.error('Error fetching student courses:', error);
                document.querySelector(placeholderSelector).innerHTML = 
                    '<div class="alert alert-danger">Có lỗi xảy ra khi tải danh sách khóa học</div>';
            });
    });
</script>